webpackJsonp([2,0],[function(t,e,o){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var s=o(90),r=n(s),i=o(89),a=n(i),u=o(88),d=n(u),c=o(76),l=n(c),m=o(77),f=n(m),h=o(79),p=n(h),g=o(81),v=n(g),_=o(78),w=n(_);o(55),r.default.use(a.default),r.default.use(d.default),r.default.use(l.default);var y=[{path:"/login",component:p.default},{path:"/roomList",component:v.default},{path:"/chatRoom",component:w.default}],b=new a.default({routes:y});new r.default({router:b,template:"<App/>",components:{App:f.default}}).$mount("#app")},,,,,,,,,,,,,,,,,,,,function(t,e,o){var n,s;o(51),n=o(29);var r=o(84);s=n=n||{},"object"!=typeof n.default&&"function"!=typeof n.default||(s=n=n.default),"function"==typeof s&&(s=s.options),s.render=r.render,s.staticRenderFns=r.staticRenderFns,s._scopeId="data-v-7e1128ad",t.exports=n},,,,,function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"app",mounted:function(){window.document.title="Secure Chat Room",this.$router.push("login")},head:{meta:[{name:"viewport",content:"width=device-width, initial-scale=1"}]}}},function(t,e,o){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=o(31),r=n(s),i=o(61),a=o(20),u=n(a),d=o(80),c=n(d);e.default={name:"chatRoom",components:{Bubble:u.default,MessageBox:c.default},mounted:function(){window.localStorage.getItem("jwt")||this.$router.push("login"),window.socket||this.$router.push("roomList"),this.name=window.localStorage.getItem("name"),this.socket=window.socket,this.socket.emit("joinRoom",this.$route.query.id),this.listeners(this.socket)},data:function(){return{socket:{},roomName:"",messages:[],key:"",msgInput:"",name:""}},methods:{listeners:function(t){var e=this;t.on("room",function(t){e.roomName=t.name,e.key=t.key;for(var o=[],n=0;n<t.history.length;n++){var s=e.decryptMsg(t.history[n]);o.push(s)}e.messages=o}),t.on("msg",function(t){var o=e.decryptMsg(t);e.messages.push(o)})},send:function(){if(""!==this.msgInput.trim()){var t={name:this.name,msg:this.msgInput,time:new Date};this.socket.emit("msg",this.encryptMsg((0,r.default)(t))),this.msgInput=""}},encryptMsg:function(t){var e=i.CryptoJS.AES.encrypt(t,this.key,{format:i.JsonFormatter}).toString();return e},decryptMsg:function(t){var e=i.CryptoJS.AES.decrypt(t,this.key,{format:i.JsonFormatter}),o="";try{o=i.CryptoJS.enc.Utf8.stringify(e)}catch(t){}finally{if(""===o){var n={msg:"!!無法解密訊息!!",name:"unknown",time:new Date};o=(0,r.default)(n)}}return JSON.parse(o)}}}},function(t,e,o){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=o(69),r=n(s);e.default={name:"login",mounted:function(){var t=this,e=window.localStorage.getItem("jwt");e&&this.$http.post("verifyJwt",{token:e}).then(function(e){e.body.valid&&t.$router.push("roomList")},function(t){console.log(t)})},data:function(){return{username:"",password:"",errorMsg:""}},methods:{logOrReg:function(t){var e=this;if(""===this.username||""===this.password)return void(this.errorMsg="帳號或密碼不得為空!");var o=t,n={username:this.username,password:(0,r.default)(this.password)};this.$http.post(o,n).then(function(t){t.body.error?e.errorMsg=t.body.error:(window.localStorage.setItem("jwt",t.body.token),window.localStorage.setItem("name",t.body.name),console.log("token saved"),e.$router.push("roomList"))},function(t){console.log(t)})},login:function(){this.logOrReg("login")},register:function(){this.logOrReg("register")}}}},function(t,e,o){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=o(20),r=n(s);e.default={name:"messageBox",mounted:function(){var t=this;this.$watch("msgs",function(e,o){t.scrolled||(t.$el.scrollTop=t.$el.scrollHeight,t.scrolled=!0)})},data:function(){return{scolled:!1}},methods:{scroll:function(){this.$el.scrollHeight-this.$el.scrollTop<=this.$el.clientHeight?this.scrolled=!1:this.scrolled=!0}},components:{Bubble:r.default},props:["msgs"]}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"bubble",mounted:function(){this.msg.time=this.formatTime(this.msg.time),this.isMe=this.msg.name===window.localStorage.getItem("name")},props:["msg"],data:function(){return{isMe:!1}},methods:{formatTime:function(t){var e=new Date(t),o=e.getHours()<10?"0"+e.getHours().toString():e.getHours(),n=e.getMinutes()<10?"0"+e.getMinutes().toString():e.getMinutes();return o+":"+n}}}},function(t,e,o){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=o(70),r=n(s);e.default={name:"roomList",mounted:function(){window.localStorage.getItem("jwt")||this.$router.push("login"),window.socket||(window.socket=r.default.connect("/",{query:"token="+window.localStorage.getItem("jwt")})),this.socket=window.socket,this.socket.emit("getRoomList"),this.listeners(this.socket)},data:function(){return{listRoom:[],roomName:"",socket:{}}},methods:{addRoom:function(){this.socket.emit("createRoom",{name:this.roomName})},listeners:function(t){var e=this;t.on("room",function(t){e.listRoom.push(t)}),t.on("roomList",function(t){e.listRoom=t})},logout:function(){window.localStorage.removeItem("jwt"),window.localStorage.removeItem("name"),delete window.socket,this.$router.push("login")}}}},,,,,,,,,,,,,,,,,,,function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},,,,,,,,,,,,,,,,,,,,,,function(t,e,o){var n,s;o(50),n=o(25);var r=o(83);s=n=n||{},"object"!=typeof n.default&&"function"!=typeof n.default||(s=n=n.default),"function"==typeof s&&(s=s.options),s.render=r.render,s.staticRenderFns=r.staticRenderFns,t.exports=n},function(t,e,o){var n,s;o(49),n=o(26);var r=o(82);s=n=n||{},"object"!=typeof n.default&&"function"!=typeof n.default||(s=n=n.default),"function"==typeof s&&(s=s.options),s.render=r.render,s.staticRenderFns=r.staticRenderFns,s._scopeId="data-v-610a5303",t.exports=n},function(t,e,o){var n,s;o(52),n=o(27);var r=o(85);s=n=n||{},"object"!=typeof n.default&&"function"!=typeof n.default||(s=n=n.default),"function"==typeof s&&(s=s.options),s.render=r.render,s.staticRenderFns=r.staticRenderFns,s._scopeId="data-v-dfccd26e",t.exports=n},function(t,e,o){var n,s;o(54),n=o(28);var r=o(87);s=n=n||{},"object"!=typeof n.default&&"function"!=typeof n.default||(s=n=n.default),"function"==typeof s&&(s=s.options),s.render=r.render,s.staticRenderFns=r.staticRenderFns,s._scopeId="data-v-f8a36e98",t.exports=n},function(t,e,o){var n,s;o(53),n=o(30);var r=o(86);s=n=n||{},"object"!=typeof n.default&&"function"!=typeof n.default||(s=n=n.default),"function"==typeof s&&(s=s.options),s.render=r.render,s.staticRenderFns=r.staticRenderFns,t.exports=n},function(module,exports){module.exports={render:function(){with(this)return _h("div",{attrs:{id:"chatroom"}},[_h("div",{staticClass:"row",attrs:{id:"title"}},[_h("h1",[_s(roomName)])," ",_h("router-link",{attrs:{to:"roomList",id:"back"}},["回房間列表"])])," ",_h("messageBox",{attrs:{msgs:messages}})," ",_h("div",{staticClass:"row"},[_h("textarea",{directives:[{name:"model",rawName:"v-model",value:msgInput,expression:"msgInput"}],attrs:{id:"inputbox"},domProps:{value:_s(msgInput)},on:{keypress:function(t){13===t.keyCode&&send(t)},input:function(t){t.target.composing||(msgInput=t.target.value)}}})," ",_h("button",{on:{click:send}},["送出"])])])},staticRenderFns:[]}},function(module,exports){module.exports={render:function(){with(this)return _h("div",{staticClass:"container",attrs:{id:"app"}},[_h("router-view")])},staticRenderFns:[]}},function(module,exports){module.exports={render:function(){with(this)return _h("div",{class:{me:isMe,other:!isMe},attrs:{id:"bubble"}},[_h("div",[_h("div",{attrs:{id:"namecontainer"}},[_h("p",[_s(msg.name)])])," ",_h("div",{attrs:{id:"msgandtime"}},[_h("div",[_s(msg.msg)])," ",_h("p",[_s(msg.time)])])])])},staticRenderFns:[]}},function(module,exports){module.exports={render:function(){with(this)return _h("div",{attrs:{id:"login"}},[_m(0)," ",_m(1)," ",_h("div",{staticClass:"row"},[_h("input",{directives:[{name:"model",rawName:"v-model",value:username,expression:"username"}],staticClass:"input",domProps:{value:_s(username)},on:{input:function(t){t.target.composing||(username=t.target.value)}}})])," ",_m(2)," ",_h("div",{staticClass:"row"},[_h("input",{directives:[{name:"model",rawName:"v-model",value:password,expression:"password"}],staticClass:"input",attrs:{type:"password"},domProps:{value:_s(password)},on:{input:function(t){t.target.composing||(password=t.target.value)}}})])," ",_h("div",{staticClass:"row",attrs:{id:"btns"}},[_h("button",{on:{click:login}},["登入"])])," ",_h("div",{staticClass:"row"},[_h("button",{on:{click:register}},["註冊"])])," ",_h("h3",[_s(errorMsg)])])},staticRenderFns:[function(){with(this)return _h("h1",["登入or註冊"])},function(){with(this)return _h("div",{staticClass:"row"},[_h("p",["帳號"])])},function(){with(this)return _h("div",{staticClass:"row"},[_h("p",["密碼"])])}]}},function(module,exports){module.exports={render:function(){with(this)return _h("div",{attrs:{id:"roomList"}},["\n  房間名稱:",_h("input",{directives:[{name:"model",rawName:"v-model",value:roomName,expression:"roomName"}],domProps:{value:_s(roomName)},on:{input:function(t){t.target.composing||(roomName=t.target.value)}}})," ",_h("button",{on:{click:addRoom}},["新建房間!"])," ",_h("button",{on:{click:logout}},["登出"])," ",_h("ul",[_l(listRoom,function(t){return _h("li",[_h("router-link",{attrs:{to:{path:"chatRoom",query:{id:t._id}}}},["\n        "+_s(t.name)+"("+_s(t._id)+")\n      "])])})])])},staticRenderFns:[]}},function(module,exports){module.exports={render:function(){with(this)return _h("div",{attrs:{id:"msgbox"},on:{scroll:scroll}},[_l(msgs,function(t){return _h("bubble",{attrs:{msg:t}})})])},staticRenderFns:[]}},,,,,,function(t,e){}]);
//# sourceMappingURL=app.61e48539b8ed68ddb984.js.map